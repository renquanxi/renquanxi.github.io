<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | 技术笔记</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.7a95b531.css" as="style"><link rel="preload" href="/assets/js/app.f1d5f3b1.js" as="script"><link rel="preload" href="/assets/js/2.a31f7225.js" as="script"><link rel="preload" href="/assets/js/13.1a5d6cc6.js" as="script"><link rel="prefetch" href="/assets/js/10.3a106151.js"><link rel="prefetch" href="/assets/js/11.765d58aa.js"><link rel="prefetch" href="/assets/js/12.69b2a4c1.js"><link rel="prefetch" href="/assets/js/14.bb1a54b2.js"><link rel="prefetch" href="/assets/js/15.8e34e0d9.js"><link rel="prefetch" href="/assets/js/16.1302e1f6.js"><link rel="prefetch" href="/assets/js/17.41a29044.js"><link rel="prefetch" href="/assets/js/18.3251f510.js"><link rel="prefetch" href="/assets/js/19.fbbc7648.js"><link rel="prefetch" href="/assets/js/20.8afc9e9c.js"><link rel="prefetch" href="/assets/js/21.3b0c3f61.js"><link rel="prefetch" href="/assets/js/22.e142d199.js"><link rel="prefetch" href="/assets/js/23.c58d9913.js"><link rel="prefetch" href="/assets/js/24.61e95af3.js"><link rel="prefetch" href="/assets/js/25.97324030.js"><link rel="prefetch" href="/assets/js/26.c703380f.js"><link rel="prefetch" href="/assets/js/27.8f04bfae.js"><link rel="prefetch" href="/assets/js/28.df272430.js"><link rel="prefetch" href="/assets/js/29.d0afc8d6.js"><link rel="prefetch" href="/assets/js/3.6875c7a2.js"><link rel="prefetch" href="/assets/js/30.42cc198d.js"><link rel="prefetch" href="/assets/js/4.e47c515c.js"><link rel="prefetch" href="/assets/js/5.a43f5d00.js"><link rel="prefetch" href="/assets/js/6.68047c68.js"><link rel="prefetch" href="/assets/js/7.cdca8d21.js"><link rel="prefetch" href="/assets/js/8.4cd750a1.js"><link rel="prefetch" href="/assets/js/9.2874b7a4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7a95b531.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">技术笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">前端基础</a></div><div class="nav-item"><a href="/.vuepress/vue/" class="nav-link">测试代码</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">诗和远方</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/name/" class="nav-link">诗酒</a></li><li class="dropdown-item"><!----> <a href="/age/" class="nav-link">年华</a></li><li class="dropdown-item"><!----> <a href="/create/" class="nav-link">博客搭建</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/accumulate/" class="nav-link router-link-active">前端基础</a></div><div class="nav-item"><a href="/.vuepress/vue/" class="nav-link">测试代码</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">诗和远方</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/name/" class="nav-link">诗酒</a></li><li class="dropdown-item"><!----> <a href="/age/" class="nav-link">年华</a></li><li class="dropdown-item"><!----> <a href="/create/" class="nav-link">博客搭建</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/accumulate/01-JS语法基础.html" class="sidebar-link">JS基础语法</a></li><li><a href="/accumulate/02-JS高级语法.html" class="sidebar-link">JS高级语法</a></li><li><a href="/accumulate/03-webAPI.html" class="sidebar-link">webApI</a></li><li><a href="/accumulate/04-jQuery常用语法.html" class="sidebar-link">jQuery常用语法</a></li><li><a href="/accumulate/05-ES6.html" class="sidebar-link">ES6 常用新增语法</a></li><li><a href="/accumulate/06-Ajax 笔记整理.html" class="sidebar-link">1.1 Ajax简述</a></li><li><a href="/accumulate/07-nodejs.html" class="active sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-node概述" class="sidebar-link">1.Node概述</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-1-node介绍" class="sidebar-link">1.1 Node介绍</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-2-nodejs中的js和浏览器中的js的区别" class="sidebar-link">1.2 nodejs中的JS和浏览器中的JS的区别</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-3-为什么要学习nodejs" class="sidebar-link">1.3 为什么要学习Nodejs</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-4-安装nodejs" class="sidebar-link">1.4 安装Nodejs</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_1-5-node初体验" class="sidebar-link">1.5 node初体验</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_2-node学习" class="sidebar-link">2. Node学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_2-1-前言" class="sidebar-link">2.1 前言</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_2-2-全局变量" class="sidebar-link">2.2 全局变量</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_2-3-node核心模块" class="sidebar-link">2.3 node核心模块</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_2-4-http模块" class="sidebar-link">2.4 http模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_3-留言板案例" class="sidebar-link">3. 留言板案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_3-1-准备工作" class="sidebar-link">3.1 准备工作</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_3-2-实现留言列表" class="sidebar-link">3.2 实现留言列表</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_3-3-实现添加留言功能" class="sidebar-link">3.3 实现添加留言功能</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_4-node第三方包的使用" class="sidebar-link">4.node第三方包的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_4-1-npm概述" class="sidebar-link">4.1 npm概述</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_4-2-使用npm安装node包" class="sidebar-link">4.2 使用npm安装Node包</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_4-3-使用包处理问题" class="sidebar-link">4.3 使用包处理问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_5-补充，开发留言板案例" class="sidebar-link">5.补充，开发留言板案例</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-express包" class="sidebar-link">6. express包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-1-express-介绍" class="sidebar-link">6.1 express 介绍</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-2-使用express构造web服务器" class="sidebar-link">6.2 使用Express构造Web服务器</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-3-中间件" class="sidebar-link">6.3 中间件</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-4-自定义中间件处理静态资源文件的读取及响应" class="sidebar-link">6.4 自定义中间件处理静态资源文件的读取及响应</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_6-5-使用express自带的方法处理静态资源文件" class="sidebar-link">6.5 使用express自带的方法处理静态资源文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_7-浏览器发送请求和服务器响应" class="sidebar-link">7.浏览器发送请求和服务器响应</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_7-1浏览器如何发送请求" class="sidebar-link">7.1浏览器如何发送请求</a></li><li class="sidebar-sub-header"><a href="/accumulate/07-nodejs.html#_7-2服务器如何响应" class="sidebar-link">7.2服务器如何响应</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js"><a href="#node-js" aria-hidden="true" class="header-anchor">#</a> Node.js</h1> <h2 id="_1-node概述"><a href="#_1-node概述" aria-hidden="true" class="header-anchor">#</a> 1.Node概述</h2> <h3 id="_1-1-node介绍"><a href="#_1-1-node介绍" aria-hidden="true" class="header-anchor">#</a> 1.1 Node介绍</h3> <ul><li><p>Node全名是Node.js，但它不是一个js文件，而是一个软件</p></li> <li><p>Nodejs是一个基于Chrome V8引擎的ECMAScript的运行环境</p></li> <li><p>Nodejs可以执行js文件</p></li> <li><p>Nodejs提供了大量的工具（API），能够让我们完成文件读写、Web服务器创建等功能</p></li></ul> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1552614845170.png" alt=""></p> <h3 id="_1-2-nodejs中的js和浏览器中的js的区别"><a href="#_1-2-nodejs中的js和浏览器中的js的区别" aria-hidden="true" class="header-anchor">#</a> 1.2 nodejs中的JS和浏览器中的JS的区别</h3> <ul><li>安装了浏览器这个软件，它不但可以执行ECMAScript，浏览器这个软件内置了window对象，所以浏览器有处理DOM和BOM的能力。</li> <li>安装了NodeJs这个软件，它不但可以执行ECMAScript，NodeJS这个软件也内置了一些东西，包括全局成员和模块系统。</li></ul> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/29.png" alt=""></p> <h3 id="_1-3-为什么要学习nodejs"><a href="#_1-3-为什么要学习nodejs" aria-hidden="true" class="header-anchor">#</a> 1.3 为什么要学习Nodejs</h3> <p>在我们熟悉的浏览器上执行JS不是很好吗？为什么还要安装Nodejs，要学习Nodejs呢？主要原因：</p> <ul><li>大前端必备技能</li> <li>使得JS能够和操作系统 “互动”（读写、创建文件等，还可以处理计算机中的进程）</li> <li>为JavaScript提供了服务端编程的能力
<ul><li>文件IO</li> <li>网络IO</li></ul></li> <li>了解服务器这个黑盒内部的实现原理</li> <li>了解接口开发</li> <li>进一步理解Web开发</li></ul> <h3 id="_1-4-安装nodejs"><a href="#_1-4-安装nodejs" aria-hidden="true" class="header-anchor">#</a> 1.4 安装Nodejs</h3> <p>官网： https://Nodejs.org/en/</p> <p>中文网：http://Nodejs.cn/</p> <ul><li>版本说明
<ul><li><strong>LTS</strong>： 长期稳定版。 实际项目开发建议使用长期稳定版</li> <li><strong>Current</strong>： 最新版。最新版包含了一些新功能，如果想学习最新的功能，则可以使用该版本。但是，最新版可能会有一些未知的bug</li></ul></li> <li>安装
<ul><li>到底选择哪个文件文件
<ul><li>node-v10.15.3.pkg</li> <li>node-v10.15.3-x86.msi    --  windows32位系统  （右键我的电脑--&gt;属性，可以查看电脑是32位）</li> <li>node-v10.15.3-x64.msi    --  windows64位系统</li></ul></li></ul></li></ul> <ol><li><p>双击安装文件开始安装（不同系统选择对应的安装文件）</p></li> <li><p>傻瓜式安装，一路 'next' 即可</p></li> <li><p>测试</p></li></ol> <p>在桌面上或者是任意一个文件夹，按住 shift 键 , 点击鼠标右键，选择 '在此处打开命令窗口'</p> <p>进入黑窗口后输入： <code>node -v</code>或<code>node --version</code></p> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/28.png" alt=""></p> <p>能够看到Nodejs版本号即为安装成功。</p> <h3 id="_1-5-node初体验"><a href="#_1-5-node初体验" aria-hidden="true" class="header-anchor">#</a> 1.5 node初体验</h3> <p>既然说node安装后，也可以执行JS，那么我们就用node执行一行js代码试试，或者写一个js文件，让node执行以下。</p> <p>问：如何使用node？</p> <p>答：使用命令行工具，具体如下</p> <ul><li><p>执行一行JS代码</p> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1552616127413.png" alt=""></p></li> <li><p>执行一个JS文件</p></li></ul> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1552616444350.png" alt=""></p> <p>注意事项：</p> <ul><li>输入node回车后，要按两次Ctrl+C，才能回到目录中（Ctrl一直按着不放也可以，松开从新按也可以）</li> <li>执行js文件时，如果当前命令行目录和js文件<strong>不在</strong>同一个盘符下，要先切换盘符</li> <li>执行js文件时，如果当前命令行目录和js文件<strong>在</strong>同一个盘符中，则可以使用相对路径找到js文件并执行</li> <li>体会，此时执行的js代码或文件和浏览器没有任何关系，他们是通过node执行的</li></ul> <h2 id="_2-node学习"><a href="#_2-node学习" aria-hidden="true" class="header-anchor">#</a> 2. Node学习</h2> <h3 id="_2-1-前言"><a href="#_2-1-前言" aria-hidden="true" class="header-anchor">#</a> 2.1 前言</h3> <p>前面介绍了node也提供了一种JS的执行环境，确切的说是ECMAScript的执行环境。</p> <p>node不但可以执行我们学习过的ECMAScript，node还自带了很多全局对象和很多模块。</p> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1552618083956.png" alt=""></p> <h3 id="_2-2-全局变量"><a href="#_2-2-全局变量" aria-hidden="true" class="header-anchor">#</a> 2.2 全局变量</h3> <p>说明：</p> <ul><li><p>node中有一个全局变量global，是node中最大的一个对象，相当于浏览器中的window对象。</p></li> <li><p>global中的成员在使用时，可以省略global，这点也类似浏览器中的window</p></li></ul> <p>下面介绍几个全局对象global中的成员：</p> <ul><li>console，我们在初体验时，使用了console，它可不是浏览器中的console对象，使用的是node中的console</li> <li>process，和进程相关的对象</li> <li>setInterval，同理，也是node中的，不是浏览器中的</li> <li><strong>require()</strong>，它是全局对象global中的一个方法，用于在js文件中引入另外的文件</li> <li>__dirname，当前执行文件的绝对路径（在js文件中使用）</li> <li>__filename，当前执行文件的绝对路径，包含文件名（在js文件中使用）</li></ul> <p>上述成员使用下面的代码进行演示：</p> <p>01-demo.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大于'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// alert(234); // 报错，alert is not defined</span>
global<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1234</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

global<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'随便'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 表示当前执行的js文件的所在路径</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 表示当前执行的js文件所在路径和文件名</span>

<span class="token comment">// 引入02-demo.js文件</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./02-demo.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>02-demo.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'我是02'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-3-node核心模块"><a href="#_2-3-node核心模块" aria-hidden="true" class="header-anchor">#</a> 2.3 node核心模块</h3> <blockquote><p>模块是Node.js 平台自带的一套基本的 API(功能模块)。</p></blockquote> <h4 id="_2-3-1-path模块"><a href="#_2-3-1-path模块" aria-hidden="true" class="header-anchor">#</a> 2.3.1 path模块</h4> <blockquote><p>处理路径的模块</p></blockquote> <ul><li>http://nodejs.cn/api/path.html</li> <li>操作文件的时候经常要对文件的路径做处理，或者获取文件的后缀，使用 <code>path</code> 模块。</li> <li><code>path</code> 是 Node 本身提供的 API，专门用来处理路径。</li> <li><code>path</code> 仅仅用来处理路径的字符串，不一定存在对应的物理文件。</li></ul> <hr> <ul><li><p>使用方法</p> <ul><li><p>加载模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 使用核心模块之前，首先加载核心模块</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>调用path模块中的方法，来处理相应的问题，下面列举path模块中的几个方法</p> <table><thead><tr><th>方法</th> <th>作用</th></tr></thead> <tbody><tr><td>path.basename(path[, ext])</td> <td>返回 path 的最后一部分(文件名)</td></tr> <tr><td>path.dirname(path)</td> <td>返回目录名</td></tr> <tr><td>path.extname(path)</td> <td>返回路径中文件的扩展名(包含.)</td></tr> <tr><td>path.format(pathObject)</td> <td>将一个对象格式化为一个路径字符串</td></tr> <tr><td>path.join([...paths])</td> <td>拼接路径</td></tr> <tr><td>path.parse(path)</td> <td>把路径字符串解析成对象的格式</td></tr> <tr><td>path.resolve([...paths])</td> <td>基于当前<strong>工作目录</strong>拼接路径</td></tr></tbody></table> <blockquote><p>工作目录：当前运行 Node 程序的目录</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// extname -- 获取文件后缀</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .html</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token string">'index.coffee.md'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// .md</span>

<span class="token comment">// join -- 智能拼接路径</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \a\b\c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a\b\c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">'/b/../c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \a\c</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \a\b\index.html</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 得到一个绝对路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul></li></ul> <h4 id="_2-3-2-fs模块"><a href="#_2-3-2-fs模块" aria-hidden="true" class="header-anchor">#</a> 2.3.2 fs模块</h4> <blockquote><p>文件操作模块</p></blockquote> <ul><li>http://nodejs.cn/api/fs.html</li> <li>文件系统，对文件/文件夹的操作  file system</li></ul> <hr> <ul><li><p>使用方法</p> <ul><li><p>加载模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 引入模块，引入模块的时候，可以使用var、let，但是建议使用const，因为我们不希望它改变</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>调用fs模块的方法，下面列举fs模块中的常用方法</p> <table><thead><tr><th>API</th> <th>作用</th> <th>备注</th></tr></thead> <tbody><tr><td>fs.access(path, callback)</td> <td>判断路径是否存在</td> <td></td></tr> <tr><td>fs.appendFile(file, data, callback)</td> <td>向文件中追加内容</td> <td></td></tr> <tr><td>fs.copyFile(src, callback)</td> <td>复制文件</td> <td></td></tr> <tr><td>fs.mkdir(path, callback)</td> <td>创建目录</td> <td></td></tr> <tr><td>fs.readDir(path, callback)</td> <td>读取目录列表</td> <td></td></tr> <tr><td>fs.rename(oldPath, newPath, callback)</td> <td>重命名文件/目录</td> <td></td></tr> <tr><td>fs.rmdir(path, callback)</td> <td>删除目录</td> <td>只能删除空目录</td></tr> <tr><td>fs.stat(path, callback)</td> <td>获取文件/目录信息</td> <td></td></tr> <tr><td>fs.unlink(path, callback)</td> <td>删除文件</td> <td></td></tr> <tr><td>fs.watch(filename[, options][, listener])</td> <td>监视文件/目录</td> <td></td></tr> <tr><td>fs.watchFile(filename[, options], listener)</td> <td>监视文件</td> <td></td></tr></tbody></table> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// readFile -- 异步读取文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./test.json'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件出错'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取到的二进制数据</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./test.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取文件出错'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取到的原始数据</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// writeFile -- 异步写入文件</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./abc.html'</span><span class="token punctuation">,</span> <span class="token string">'hello world'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入文件失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li></ul> <h4 id="_2-3-3-querystring模块"><a href="#_2-3-3-querystring模块" aria-hidden="true" class="header-anchor">#</a> 2.3.3 querystring模块</h4> <blockquote><p>查询字符串处理模块</p></blockquote> <ul><li>处理查询字符串（请求参数）的模块</li></ul> <hr> <ul><li><p>使用方法</p> <ul><li><p>加载模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>调用querystring模块中的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// parse -- 将查询字符串解析成JS对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'id=1&amp;name=zs&amp;age=20'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// { id: '1', name: 'zs', age: '20' }</span>

<span class="token comment">// stringify -- 将JS对象转成查询字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'zs'</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token string">'20'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// id=1&amp;name=zs&amp;age=20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></li></ul> <h4 id="_2-3-4-url模块"><a href="#_2-3-4-url模块" aria-hidden="true" class="header-anchor">#</a> 2.3.4 url模块</h4> <blockquote><p>url模块：处理url</p> <p>一个完整的url  协议://主机地址:[端口]/文件地址?参数</p></blockquote> <ul><li>提供两套处理url的API</li> <li>遗留的API，提供url.parse();方法解析url</li> <li>新的API，通过实例化URL，来解析url</li></ul> <hr> <ul><li><p>使用方法</p> <ul><li><p>加载模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>遗留API使用方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myURL <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'/test.html?id=11&amp;age=22'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回一个包含url各个部分的对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>新的API使用方法，实例化的时候，必须传递一个<strong>完整的</strong>url</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 直接提供一个完整的url</span>
<span class="token keyword">let</span> myURL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'http://www.xxx.com/test.html?id=11&amp;age=22'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或</span>
<span class="token comment">// 提供两个参数，一是文件路径及参数部分，二是域名，总之，二者组合必须是完整的url</span>
<span class="token keyword">let</span> myURL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">'/test.html?id=11&amp;age=22'</span><span class="token punctuation">,</span> <span class="token string">'http://www.xxx.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 得到的myURL是一个对象，包含url中的各个部分</span>
<span class="token comment">// 如果需要解析参数部分，则使用querystring模块，或使用URL的一个子对象searchParams中的get方法</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> myURL<span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>； <span class="token comment">// 22</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li></ul> <h3 id="_2-4-http模块"><a href="#_2-4-http模块" aria-hidden="true" class="header-anchor">#</a> 2.4 http模块</h3> <blockquote><p>http服务器处理模块，用于创建服务器</p> <p>node不同于Apache，安装完node并没有一个能够提供Web服务环境，需要使用http模块自己来搭建Web服务器</p></blockquote> <ul><li>http是一个系统模块，让我们能够通过简单的流程创建一个Web服务器</li></ul> <hr> <h4 id="_2-4-1-使用http模块搭建web服务器"><a href="#_2-4-1-使用http模块搭建web服务器" aria-hidden="true" class="header-anchor">#</a> 2.4.1 使用http模块搭建Web服务器</h4> <ul><li><p>使用http模块搭建Web服务器</p> <p>创建 Web 服务器的步骤</p> <ul><li>导入 http 核心模块</li> <li>调用http.createServer() 创建 server 对象(server 对象负责建立连接，接收数据)</li> <li>注册 request 事件，当浏览器发送请求到服务器执行，设置处理请求的函数</li> <li>监听端口（这个步骤也可以放到注册request事件之前）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 0. 加载 http 核心模块</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 创建服务器，得到 Server 实例</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 监听客户端的 request 请求事件，设置请求处理函数</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 形参req是请求request的简写</span>
  <span class="token comment">// 形参res是响应response的简写</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'收到客户端的请求了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. 绑定端口号，启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>当服务器接收到浏览器的请求后，如果没有做出响应，浏览器会等待</li> <li>服务器的最终目的是要根据请求做出响应</li></ul></li></ul> <h4 id="_2-4-2-如何对浏览器的请求做出响应"><a href="#_2-4-2-如何对浏览器的请求做出响应" aria-hidden="true" class="header-anchor">#</a> 2.4.2 如何对浏览器的请求做出响应</h4> <blockquote><p>当收到浏览器的请求后，会调用处理请求的函数（有两个核心参数 request 和 response）</p></blockquote> <p>请求已经能够收到了，现在急需给浏览器的请求做出响应，这里就使用到了处理请求的函数，具体的是使用到了该函数的第二个参数，见下面的代码。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 代码片段</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 该函数就是处理请求响应的函数</span>
  <span class="token comment">// 形参res是响应response的简写</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><a href="http://nodejs.cn/api/http.html#http_class_http_serverresponse" target="_blank" rel="noopener noreferrer">形参res<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li>形参res是response的缩写</li> <li>响应对象，服务器给浏览器返回的响应内容，可以通过该对象设置</li> <li>res.write()  设置响应体（返回给浏览器的内容）的内容，可以多次调用，但是只调用write不会做出响应，发送响应要调用 end()</li> <li>res.end()    把响应报文（响应行、响应头、响应体）发送给浏览器==响应返回给浏览器的可以使任何数据，标签，文字，数字，字母都可以，（若返回给浏览器的数据带有文字的话就必须设置请求头）==</li> <li>res.setHeader()  设置响应头，比如设置响应体的编码</li> <li>statusCode 设置状态码</li></ul></li></ul> <p>PS：浏览器在请求服务器的时候，默认会请求网站根目录下的 <code>/favicon.ico</code> 网站图标</p> <ul><li><p>响应代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 0. 加载 http 核心模块</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 创建服务器，得到 Server 实例</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 监听客户端的 request 请求事件，设置请求处理函数</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置响应头，设置编码，否则浏览器收到的是乱码</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// end中就是返回给浏览器的数据</span>
  	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello，我是服务器，我收到你的请求了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. 绑定端口号，启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 如果需要将一个html页面返回给浏览器，则读取文件，然后返回即可</span>

<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 1. 创建服务器，得到 Server 实例</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 监听客户端的 request 请求事件，设置请求处理函数</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./test.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果读取中出现错误，则抛出错误</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
        <span class="token comment">// 没有错误，则返回读取的html，因为html中设置编码，所以这里不需要设置编码</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. 绑定端口号，启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ul> <h4 id="_2-4-3-根据不同-url-地址处理不同请求"><a href="#_2-4-3-根据不同-url-地址处理不同请求" aria-hidden="true" class="header-anchor">#</a> 2.4.3 根据不同 url 地址处理不同请求</h4> <p>前面已经可以对浏览器的请求做出响应了，但是响应的内容总是一样的。能不能根据url的不同，做出合适的响应呢？当然可以，那么首先就需要知道浏览器请求的url是什么。</p> <p>涉及到和请求相关的信息，都是通过请求响应处理函数的第一个参数完成的。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token comment">// 形参req 是 请求request的意思，所有和请求相关的信息，都在req对象中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p><a href="http://nodejs.cn/api/http.html#http_class_http_incomingmessage" target="_blank" rel="noopener noreferrer">形参req<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ul><li>请求对象，浏览器发送的请求报文中的数据已经被解析到该对象上</li> <li><strong>request.url</strong>            获取请求行中的路径</li> <li><strong>request.method</strong>   获取请求行中的请求方法</li> <li>request.headers    获取请求头</li></ul></li> <li><p>代码实例</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 服务器中有3个html文件，分别是a.html b.html c.html</span>
<span class="token comment">// 根据浏览器发来的不同的请求，分别返回这三个文件的内容</span>

<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 创建服务器，得到 Server 实例</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 监听客户端的 request 请求事件，设置请求处理函数</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 根据请求对象req，得到请求url</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 读取a.html，并通过res.end()响应浏览器的请求</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 读取b.html，并通过res.end()响应浏览器的请求</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/c'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 读取c.html，并通过res.end()响应浏览器的请求</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. 绑定端口号，启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul> <h4 id="_2-4-4-处理浏览器post方式提交的数据"><a href="#_2-4-4-处理浏览器post方式提交的数据" aria-hidden="true" class="header-anchor">#</a> 2.4.4 处理浏览器POST方式提交的数据</h4> <p>上一节，我们根据不同的url地址，对不同的请求，做出了不同的响应。但这些请求都是GET方式的请求，如果浏览器使用POST方式向服务器发送了一次请求，又该如何处理呢？</p> <p>POST请求一般会提交数据给服务器，服务器在接收数据的时候也是分块接收的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token comment">// 1. 创建服务器，得到 Server 实例</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 监听客户端的 request 请求事件，设置请求处理函数</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 假设 /add 是POST方式的请求</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/add'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 注册req的data事件，分块接收数据</span>
        <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            str <span class="token operator">+=</span> chunk<span class="token punctuation">;</span> <span class="token comment">// chunk 是块的意思，这里将分块接收到的数组拼接到str字符串中</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注册req的end事件，当数据都接收到了，会触发end事件</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里处理用户提交的数据</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 3. 绑定端口号，启动服务器</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at port 3000.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_2-4-5-处理静态资源"><a href="#_2-4-5-处理静态资源" aria-hidden="true" class="header-anchor">#</a> 2.4.5 处理静态资源</h4> <ul><li><p>静态资源指的是html文件中链接的外部资源，如css、js、image文件等等。</p></li> <li><p>如果请求的a.html 文件中链接了外部文件(静态资源)，比如css、images、js文件等，浏览器会自动再次发送请求，向服务器请求这些文件</p></li> <li><p>服务器要判断浏览器请求的路径是否是静态资源，如果是静态资源把静态资源的内容返回给浏览器</p></li></ul> <p>浏览器请求了静态资源文件，服务器就得做出响应，而且还要指定响应数据的类型，否则浏览器会把字符串当做纯文本处理。</p> <p>建议每个响应都告诉客户端我给你发送的 Content-Type 内容类型是什么</p> <p>为不同的文件类型设置不同的 Content-Type</p> <ul><li>.html：text/html</li> <li>.css：text/css</li> <li>.js：application/javascript</li> <li>.jpg：image/jpg</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/css'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-4-6-处理-404"><a href="#_2-4-6-处理-404" aria-hidden="true" class="header-anchor">#</a> 2.4.6 处理 404</h4> <ul><li><p>404是一个响应状态码，表示请求的资源不存在</p></li> <li><p>如果请求未处理的路径，服务器不会做任何的响应，此时浏览器处于等待状态</p></li> <li><p>如果浏览器请求未处理的路径，统一设置响应码 <code>404</code>，并做友好提示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 设置状态码为404</span>
response<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span>
response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'对不起，您请求的页面未找到'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul> <h2 id="_3-留言板案例"><a href="#_3-留言板案例" aria-hidden="true" class="header-anchor">#</a> 3. 留言板案例</h2> <blockquote><p>ajax学习中，做过这个案例。当时使用的是老师提供的接口来完成的。现在，学习了node，我们自己来处理浏览器的请求。</p> <p><strong>此次开发，使用不使用ajax无所谓，关键是如何来处理浏览器的请求</strong></p></blockquote> <h3 id="_3-1-准备工作"><a href="#_3-1-准备工作" aria-hidden="true" class="header-anchor">#</a> 3.1 准备工作</h3> <ol><li>新建一个文件夹，比如msg</li> <li>将使用到的html文件、css文件、图片文件、js文件等复制到准备好的文件夹msg中</li> <li>将模拟数据db.json文件复制到msg中</li> <li>在msg文件夹中，创建app.js，搭建Web服务环境</li></ol> <h3 id="_3-2-实现留言列表"><a href="#_3-2-实现留言列表" aria-hidden="true" class="header-anchor">#</a> 3.2 实现留言列表</h3> <ul><li><p>当输入地址127.0.0.0:3000/message.html，回车，会向服务器发送一次GET请求</p></li> <li><p>服务器接收到请求，要给浏览器返回它要的数据</p></li> <li><p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1553506224920.png" alt=""></p></li> <li><p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1553506295447.png" alt=""></p></li> <li><p>具体代码</p> <ul><li>==<strong>注意事项</strong>==
<ul><li>在读取了json数据以后需要用JSON.parse将其转化成js可以识别的数组套对象的模式</li> <li>在转化得到的数组要循环遍历并将留言存放在模板字符串中，</li> <li>在循环之前要先创建一个变量去接收（==创建的这个变量一定要等于空，不能只创建一个变量名仍在哪里==），这个模板字符串let  str = ‘’</li> <li>模板字符串创建完毕，并读取了html文档以后要需要用  ==字符串.replace(旧字符串，新字符串)==   语法将html中的占位符替换掉，==并用一个变量名去接收一下==，最后将这个变量名响应返回给浏览器；</li> <li>在读取==带有图片和css的文件（静态资源文件）==的时候，==不能将其转化成utf-8的模式不然图片会乱码==</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app -- application 应用、项目</span>
<span class="token comment">// 开启服务</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务启动了'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 判断url，如果是/message.html。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/message.html'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 2. 读取db.json，转成JS数组。遍历，遍历过程中，拼接li。得到所有的li</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./db.json'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// if 区间如果只有一句话，则可以省略大括号</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将JSON转成JS数组</span>
            data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 变量data数组，拼接li</span>
            <span class="token keyword">let</span> lis <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                lis <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`&lt;li class=&quot;media&quot;&gt;
                            &lt;img class=&quot;mr-3&quot; src=&quot;./assets/avatar.png&quot; /&gt;
                            &lt;div class=&quot;media-body&quot;&gt;
                                &lt;h4&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/h4&gt;
                                &lt;p&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/p&gt;
                            &lt;/div&gt;
                        &lt;/li&gt;`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 到这里所有的里都拼接好了</span>
            <span class="token comment">// 3. 读取message.html文件，替换里面的特殊字符为li</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./message.html'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 替换html中的占位符 #$$##### 为所有的li</span>
                <span class="token comment">// message.html中id为messages的ul中放入 #$$##### 占位。下面的代码就是替换该占位符的</span>
                html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'#$$#####'</span><span class="token punctuation">,</span> lis<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 4. 将完整的html返回给浏览器</span>
                res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 5. 处理静态资源文件</span>
        <span class="token comment">// console.log(req.url);</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div></li></ul> <h3 id="_3-3-实现添加留言功能"><a href="#_3-3-实现添加留言功能" aria-hidden="true" class="header-anchor">#</a> 3.3 实现添加留言功能</h3> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/1553506689176.png" alt=""></p> <ul><li><p>点击界面中的“添加”时，向服务器发送请求，并提交数据给服务器，</p> <ul><li>注意设置表单的action和method</li> <li>注意，设置表单各项的name值</li> <li>注意，button，不用设置type属性，就是要默认的submit类型即可</li></ul></li> <li><p>服务器接收到请求，完成数据添加，并作出响应，告知浏览器添加成功与否</p></li> <li><p><strong>代码：</strong></p> <ul><li><p>==注意事项==</p> <ul><li><p>因为留言的传输是通过==post==的方式的所以在接收留言信息的时候需要先声明一个变量                     （let  lis = ‘’），并使用==req.on('data',chunk=&gt;  lis+=chunk)方式去接收传送的信息==</p></li> <li><p>在接收完了信息以后需要将其幻化层js可以识别的对象</p></li> <li><p>在读取了json数据之后将其转化成数组并向里面push接收的留言信息的时候，==不要用变量名去接收==，因为==数组.push（元素)，该语法返回的是添加完新元素以后该数组的长度（length）==；下次用的时候直接用这个数组就行了不用再去接收了</p></li> <li><p>添加完新元素直接将其转化json数据，然后在将其写入到json文件中即可</p></li> <li><p>在响应返回给浏览器的数据中若有文字格式的数据，就必须设置请求头，</p></li> <li><p>返回给浏览器的也可以是标签</p></li></ul></li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'/addMsg'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">//添加留言时候</span>
   	<span class="token comment">//获取发送过来的留言信息</span>
        <span class="token keyword">let</span> lis <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> lis<span class="token operator">+=</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
        req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//接收完成以后转化成对象格式</span>
            lis <span class="token operator">=</span> queryshring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//读取json文件中留言信息</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./db.JSON'</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>addly</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//将读取的json数据转化W为对象格式</span>
                addly <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>addly<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//将接收的来历添加到json留言信息中</span>
                addly<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//将添加完信息的json数据转化为json数据格式（查询字符串）</span>
                addly <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>addly<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">//将json数据写入到json文件中</span>
                fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./db.json'</span><span class="token punctuation">,</span>addly<span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> err<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//此处如果不设置请求头的话那么创给  浏览器的“添加完成”字符就是乱码的</span>
            res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span><span class="token string">'text/html；charset=utf-8'</span><span class="token punctuation">)</span>
            <span class="token comment">//添加完成以后返回给浏览器一个弹框“添加完成”，并跳转到留言页面</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;script&gt;alert(&quot;添加完成&quot;);location.href = &quot;/message.html&quot;&lt;/script&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="_4-node第三方包的使用"><a href="#_4-node第三方包的使用" aria-hidden="true" class="header-anchor">#</a> 4.node第三方包的使用</h2> <p>本地安装资源</p> <p>①mime  处理静态资源   ②art - template  模板引擎  ③express  node.js的框架</p> <p>④express-art-template模板引擎    ⑤body-parser处理post请求</p> <p>⑥mysql   连接服务器  ⑦express - session处理会话技术 ⑧</p> <p>全局安装资源</p> <h3 id="_4-1-npm概述"><a href="#_4-1-npm概述" aria-hidden="true" class="header-anchor">#</a> 4.1 npm概述</h3> <ul><li>npm（node package manager）翻译过来就是node包管理器</li> <li>包（package）是某个独立功能的封装，包是在模块基础上更深一步的抽象。</li> <li>简单理解：一个包中可以包含一组功能相近的模块</li> <li>再简单的理解，包就是node的插件，下载安装好就可以配合node使用了</li> <li>npm就是安装、卸载包的管理工具</li> <li>npm不用单独安装，安装完node，npm默认就安装好了</li> <li>试着执行 <code>npm -v</code> 命令，看下能否看到npm的版本</li></ul> <h3 id="_4-2-使用npm安装node包"><a href="#_4-2-使用npm安装node包" aria-hidden="true" class="header-anchor">#</a> 4.2 使用npm安装Node包</h3> <ul><li>安装一个包，分为全局安装和本地安装
<ul><li>==<strong>全局安装</strong>==
<ul><li>需要通过命令行执行的包，一般安装在全局目录中，方便随时使用命令行工具运行</li> <li>安装步骤
<ul><li>随便一个位置，运行命令行工具</li> <li>执行 ==npm install 包名 -g==即可==安装==（install可以简写为i，-g可以放到包名前面）</li> <li>删除全局安装的包，执行 ==npm uninstall 包名 -g==即可==删除==（uninstall可以简写为un）</li> <li>安装完成，只能通过命令行工具执行命令，<strong>不能</strong>通过<code>require('包名');</code> 来加载包</li></ul></li></ul></li> <li><strong>==本地安装==</strong> <ul><li>需要通过 <code>require('包名')</code> 加载使用的包，要执行本地安装</li> <li>安装步骤
<ul><li><strong>在需要安装包的文件夹</strong>，运行命令行工具</li> <li>执行 ==npm init -y   初始化==。此时会生成一个package.json的文件，该文件相当于包的配置文件</li> <li>执行命令 ==npm install 包名==  即可安装（==后面可以同时写好几个包名一起安装，中间用空格隔开==）</li> <li>安装完成，可以在<strong>当前目录或其子目录中</strong>使用 <code>require('包名');</code> 来加载包，使用它了</li></ul></li></ul></li></ul></li></ul> <blockquote><p>更多关于npm的使用，后续再详细介绍。</p> <p>所有的第三方都可以安装在一个文件中，然后以后写的node文件都写在这个文件夹的子文件夹中，然后就不用每次用一次就安装一次了</p> <p>==使用本地安装的第三方包每次使用前都要先加载一下==</p></blockquote> <ul><li>全局安装nodemon包
<ul><li>nodemon是一个帮我们自动启动Web服务的工具</li> <li>使用nodemon执行一个server.js文件后，当文件改变后，会自动重启服务（server.js 表示包含Web服务器功能的js文件）</li> <li>安装：<code>npm i nodemon -g</code></li> <li>使用：执行命令 <code>nodemon server.js</code> 即可</li></ul></li> <li>本地安装mime包
<ul><li>mime包，是一个工具，会根据文件的后缀名得到文件的mime类型，用于设置Content-Type</li> <li>安装：
<ul><li>在使用包的文件夹中，执行命令行工具</li> <li>初始化 <code>npm init -y</code></li> <li>执行 <code>npm i mime</code> 安装</li> <li>在js文件中，可以使用 <code>require('mime');</code> 加载该包，并使用了</li></ul></li></ul></li></ul> <p>==使用npm install 安装第三方包出现下面问题处理方式==</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//背景：使用npm下载时，出现错误Unexpected end of JSON input while parsing near··</span>
<span class="token comment">//意思就是缓存问题</span>

<span class="token comment">//解决方法：先清除缓存，再重新安装</span>

<span class="token comment">//清除缓存：运行</span>
<span class="token comment">//npm cache clear --force</span>

<span class="token comment">//重新安装：</span>
<span class="token comment">// install</span>
 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-3-使用包处理问题"><a href="#_4-3-使用包处理问题" aria-hidden="true" class="header-anchor">#</a> 4.3 使用包处理问题</h3> <h4 id="_4-3-1-使用nodemon启动服务"><a href="#_4-3-1-使用nodemon启动服务" aria-hidden="true" class="header-anchor">#</a> 4.3.1 使用nodemon启动服务</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 之前启动服务，每次修改代码后，都有重新启动</span>
node server<span class="token punctuation">.</span>js
<span class="token comment">// 现在，使用nodemon启动服务，之后修改代码后，nodemon会帮我们自动重启服务</span>
nodemon server<span class="token punctuation">.</span>js <span class="token comment">// server.js 表示包含Web服务器功能的js文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_1-3-2-使用mime包处理文件的content-type"><a href="#_1-3-2-使用mime包处理文件的content-type" aria-hidden="true" class="header-anchor">#</a> 1.3.2 使用mime包处理文件的Content-Type</h4> <ul><li>使用mime注意事项：
<ol><li>先要引入mime模块</li> <li>因为mime基本就是设置请求头用的，所以==要先利用path模块获取地址的后缀==</li> <li>然后利用mime中的getType方法 通过获取的后缀  来==获取到该文件的mime==（text/html,  image/jpeg等）</li> <li>然后将其==设置给请求头==</li></ol></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 代码片段（一般在处理静态资源文件时这样处理）</span>
<span class="token comment">// 根据请求的url，获取文件的后缀</span>
<span class="token keyword">let</span> ext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用mime对象的getType方法，获取该文件的mime</span>
<span class="token keyword">let</span> contentType <span class="token operator">=</span> mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置content-type</span>
response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_4-3-3-使用art-template包处理模板"><a href="#_4-3-3-使用art-template包处理模板" aria-hidden="true" class="header-anchor">#</a> 4.3.3 使用art-template包处理模板</h4> <ul><li><p>art-template介绍</p> <ul><li>art-template我们前面使用过，它是模板引擎，当时使用的是template-web.js，属于浏览器版本。</li> <li>之前使用的是浏览器版的，即在html页面中引入template-web.js</li> <li>现在，art-template支持npm安装，安装后属于node的一个包</li></ul></li> <li><p>安装</p> <ul><li>初始化 <code>npm init -y</code> （注意，之前在当前目录安装过包的话，这里就不用再次初始化了）</li> <li>本地安装 <code>npm i art-template</code></li></ul></li> <li><p>使用</p></li> <li><p>==◇在node中使用模板引擎注意事项==</p> <ol><li>在调用template方法时候需要传入两个参数第一个参数是一个==（HTML文件的）绝对路径==，（使用前可以先用path拼接一个绝对路径出来）</li> <li>第二个参数是一个==需要写入的值==，==一般是直接给直接的json文件==（不需要转化格式，直接json即可）</li> <li>使用时会返回==一个html的字符串==，直接返回给浏览器即可</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 加载art-template</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 在向浏览器响应数据的时候，使用template函数处理模板</span>
<span class="token comment">// template函数仍然是两个参数一个返回值</span>
<span class="token comment">// 参数1：待渲染的html文件</span>
<span class="token comment">// 参数2：一个js对象，需要展示的数据</span>
<span class="token comment">// 返回值：数据和html文件组合好的结果</span>
<span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token constant">HTML</span>文件<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">:</span> liuyan <span class="token comment">// arr就是要显示在HTML循环的数据，liuyan就是读取的json文件的数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3. 将template的返回值，响应（返回）给浏览器</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>==HTML文件对应代码（和以前的模板引擎语法一致）==：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code>{{each arr}}
	{{$index}} 表示数组的下标
	{{$value}} 表示数组中的值
{{/each}}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h2 id="_5-补充，开发留言板案例"><a href="#_5-补充，开发留言板案例" aria-hidden="true" class="header-anchor">#</a> 5.补充，开发留言板案例</h2> <ol><li><p>创建msg2文件夹</p></li> <li><p>将模板message.html和assets文件夹复制到msg2中</p></li> <li><p>在msg2文件夹中，创建app.js，里面的代码如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app ---   application 应用</span>
<span class="token comment">// 加载模块，所有用到的模块，都有最先加载</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载第三方模块（包）</span>

<span class="token comment">// 创建server对象</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监听端口</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'启动ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 监视浏览器的请求，如果浏览器向服务器发送请求，就会触发下面的request事件</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">'/message.html'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 说明浏览器请求的是 /message.html</span>
        <span class="token comment">// 读取message.html，响应给浏览器</span>
        <span class="token keyword">let</span> fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'message.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            <span class="token comment">// 如果没有错误，则将结果响应给浏览器</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 说明请求的是静态资源文件，读取的时候，不要转成utf-8，因为有图片</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li> <li><p>使用art-template第三方模块（包），处理模板（message.html）中待显示的数据</p> <ol><li><p>安装art-template</p> <ol><li>在msg2文件夹中使用，所以安装的时候，要将命令行工具，切换目录到msg2中</li> <li>初始化，执行 <code>npm init -y</code> ，成功后，会在msg2文件夹中生成 <code>package.json</code></li> <li>执行 <code>npm i art-template</code> 安装art-template包</li> <li>安装完成，会在msg2中，生成 node_modules文件夹，这里放的就是你安装的art-template</li></ol></li> <li><p>使用art-template</p> <ol><li><p>在app.js最开头，加载art-template</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 加载第三方模块（包）</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>判断如果url是 <code>/message.html</code>的时候，调用template函数即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 定义message.html的路径</span>
<span class="token keyword">let</span> fileName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'message.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 加载数据</span>
<span class="token keyword">let</span> liuyan <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'db.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// html文件和数据组合好的结果 = template(模板html文件路径, js对象);</span>
<span class="token comment">// template 函数会根据路径（fileName），自己去读取html文件中的内容</span>
<span class="token comment">// 会将数据 arr 和 html组合到一起</span>
<span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    arr<span class="token punctuation">:</span> liuyan
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>要将db.json文件复制到msg2文件夹中</p></blockquote></li> <li><p>在message.html中，使用each标签，循环li</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 前面分配的是arr， 所以这里each arr---&gt;</span>
{{each arr}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>media<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mr-3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./assets/avatar.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{$value.name}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>media-body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>{{$value.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{$value.content}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
{{/each}}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>此时，可以在app.js中，console.log(html)，刷新浏览器，看下组合好的结果</p></blockquote></li></ol> <p>4.将组合好的html，响应给浏览器</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 将组合好的结果，响应给浏览器</span>
res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol></li></ol> <h2 id="_6-express包"><a href="#_6-express包" aria-hidden="true" class="header-anchor">#</a> 6. express包</h2> <h3 id="_6-1-express-介绍"><a href="#_6-1-express-介绍" aria-hidden="true" class="header-anchor">#</a> 6.1 express 介绍</h3> <ul><li>Express 是一个第三方模块，用于搭建服务器</li> <li>Express 是一个基于 Node.js 平台，快速、开放、极简的 <strong>web 开发框架</strong>。</li> <li>express保留了http模块的基本API，也就是说使用express时也能使用req和res对象</li> <li>express还额外封装了一些方法，能让我们更方便的搭建服务器</li> <li>express提供了中间件功能，其他很多强大的第三方模块都是基于express开发的</li> <li><a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express 官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener noreferrer">Express 中文文档（非官方）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/expressjs/express" target="_blank" rel="noopener noreferrer">Express GitHub仓库<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="_6-2-使用express构造web服务器"><a href="#_6-2-使用express构造web服务器" aria-hidden="true" class="header-anchor">#</a> 6.2 使用Express构造Web服务器</h3> <p>==<strong>创建一个message文件夹，下面的开发在message中</strong>==</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 下载安装 express 模块</span>
<span class="token comment"># 初次安装，应该初始化</span>
<span class="token function">npm</span> init -y
<span class="token function">npm</span> i express
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用Express构建Web服务器步骤：</p> <ol><li><p>加载 express 模块</p></li> <li><p>创建 express 服务器</p></li> <li><p>开启服务器</p></li> <li><p>监听浏览器请求并进行处理</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//1. 加载 express 模块</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//2. 创建express(Web) 服务器</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//3. 开启服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'express-server is running...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//4. 监听浏览器请求并进行处理</span>
<span class="token comment">//app.get(): 用来接收get请求</span>
<span class="token comment">//app.post(): 用来接收post请求，</span>
<span class="token comment">//          post表单提交(method=post)</span>

<span class="token comment">//如果浏览器请求的地址为 http://127.0.0.1:3000/message.html，表示以GET方式请求index接口，所以会执行下面的方法</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/message.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'index-page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>  
<span class="token comment">//如果浏览器请求的地址为 http://127.0.0.1:3000/login，则会执行该方法</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//send方法是express封装的方法</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'登录页'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// * : 通配符，代表任意地址</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404 not found'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>总结：</p> <ol><li>使用express构造服务器也是4步流程：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span>  express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ① 加载express模块</span>
<span class="token keyword">const</span>  app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				  <span class="token comment">// ② 创建express服务器</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>			  <span class="token comment">// ③ 开启express服务器</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>   app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>  <span class="token comment">// ④ 注册服务器事件 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>注册服务器事件有两个方法： app.get() 和 app.post()</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// get方法用来接收get请求，浏览器地址栏发起的请求都是get请求</span>
<span class="token comment">// post方法用来接收post请求，接收post表单提交的请求</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>express框架封装了一些额外的API（例如:send），可以让我们更方便的构造Web服务器</li></ol> <p>​	3.1 ）使用send方法响应数据的话，会自动设置content-type。</p> <p>​	3.1 ）注意send不能直接响应数字，需要加引号</p> <ol start="4"><li>浏览器请求的每一个url地址都会由一个独立方法接收并处理，没有了 if ... else if ... else 这样的分支，程序结构
更加清晰</li></ol> <p>5）sendFile(文件路径); -- 功能是读取文件，并将读取到的结果响应给浏览器</p> <h3 id="_6-3-中间件"><a href="#_6-3-中间件" aria-hidden="true" class="header-anchor">#</a> 6.3 中间件</h3> <p>==复制message为message1，下面的开发在message1里面==</p> <p>为了理解中间件，我们先来看一下我们现实生活中的自来水厂的净水流程。</p> <p><img src="https://renquanxi.github.io/iamgeWarehouse/img/04-node/123.png" alt=""></p> <ul><li>在上图中，自来水厂从获取水源到净化处理交给用户，中间经历了一系列的处理环节</li> <li>我们称其中的每一个处理环节就是一个中间件。</li> <li>这样做的目的既提高了生产效率也保证了可维护性。</li></ul> <p>express中间件是一个特殊的url地址处理函数</p> <ul><li>中间件是 express 的最大特色，也是最重要的一个设计</li> <li>一个 express 应用，就是由许许多多的中间件来完成的</li> <li>中间件就是一个函数，中间件函数要当做 <code>app.use();</code> 的参数，这样来使用</li> <li>中间件函数中有三个基本参数， req、res、next</li> <li>req就是请求相关的对象，它和后面用到的req对象是一个对象</li> <li>res就是响应相关的对象，它和后面用到的res对象也是一个对象</li> <li>next：它是一个函数，调用它将会跳出当前的中间件函数，执行后续代码；如果不调用next，则会在当前中间件卡住</li></ul> <h3 id="_6-4-自定义中间件处理静态资源文件的读取及响应"><a href="#_6-4-自定义中间件处理静态资源文件的读取及响应" aria-hidden="true" class="header-anchor">#</a> 6.4 自定义中间件处理静态资源文件的读取及响应</h3> <p>思路：</p> <ul><li>如果发现请求的是静态资源（url以 <code>/assets/</code> 开头），则读取他们，并返回。</li> <li>如果不是静态资源，则交给下一个中间件处理（next）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(req.url);</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 满足条件，说明是静态资源</span>
        <span class="token comment">// fs.readFile(path.join(__dirname, req.url), (err, data) =&gt; {</span>
        <span class="token comment">//     res.end(data);</span>
        <span class="token comment">// })</span>
        res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不满足条件，交给下一个中间件，否则服务器会卡住</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_6-5-使用express自带的方法处理静态资源文件"><a href="#_6-5-使用express自带的方法处理静态资源文件" aria-hidden="true" class="header-anchor">#</a> 6.5 使用express自带的方法处理静态资源文件</h3> <p>前面，为了理解中间件，都是自定义的中间件，其实，关于处理静态资源文件，express自带了更好的办法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// use的第一个参数，表示请求的url是以 /assets/ 开头的</span>
<span class="token comment">// use的第二个参数，表示到 './assets' 文件夹中去查找资源，并返回给浏览器</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'./assets'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 为了不报错，应该使用绝对路径</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/assets'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_7-浏览器发送请求和服务器响应"><a href="#_7-浏览器发送请求和服务器响应" aria-hidden="true" class="header-anchor">#</a> 7.浏览器发送请求和服务器响应</h2> <h3 id="_7-1浏览器如何发送请求"><a href="#_7-1浏览器如何发送请求" aria-hidden="true" class="header-anchor">#</a> 7.1浏览器如何发送请求</h3> <ol><li>GET方式请求、
<ul><li>在地址栏输入地址，然后点击回车键</li> <li>点击超链接跳转页面发送请求</li> <li>form表单在mothed设置get提交方式，或者不设置时默认也是get方式提交</li> <li>自己发送ajax请求</li></ul></li> <li>POST方式请求
<ul><li>form表单设置mothed属性为post防护四提交</li> <li>自己发送ajax请求</li></ul></li></ol> <h3 id="_7-2服务器如何响应"><a href="#_7-2服务器如何响应" aria-hidden="true" class="header-anchor">#</a> 7.2服务器如何响应</h3> <ol><li>GET方式
<ul><li>当收到get方式的请求时，服务器会先去读取请求的数据，在读取成功后直接返回给浏览器</li></ul></li> <li>POST方式
<ul><li>当收到post方式的请求后，服务器会先去接收浏览器提交的数据，然后对数据进行处理，并告诉浏览器处理结果</li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/accumulate/06-Ajax 笔记整理.html" class="prev">
          1.1 Ajax简述
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f1d5f3b1.js" defer></script><script src="/assets/js/2.a31f7225.js" defer></script><script src="/assets/js/13.1a5d6cc6.js" defer></script>
  </body>
</html>
